<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/favicon/apple-touch-icon.png">
 <link rel="icon" type="image/png" sizes="32x32" href="../../../../images/favicon/favicon-32x32.png">
 <link rel="icon" type="image/png" sizes="16x16" href="../../../../images/favicon/favicon-16x16.png">
 <link rel="mask-icon" href="safari-pinned-tab.svg" color="#3b6f74">
 <meta name="msapplication-TileColor" content="#3b6f74">
 <meta name="theme-color" content="#3b6f74">
 <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
 <meta http-equiv="X-UA-Compatible" content="IE=9"/>
 <meta name="generator" content="Doxygen 1.8.16"/>
 <meta name="viewport" content="width=device-width, initial-scale=1"/>
 <title>HEPfit: Usage</title>
 <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
 <script type="text/javascript" src="../../jquery.js"></script>
 <script type="text/javascript" src="../../dynsections.js"></script>
 <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
 <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
 <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
 <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
 <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
                           extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
                           jax: ["input/TeX","output/HTML-CSS"],
                           tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
                           messageStyle: "none"
                           });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
 <div id="titlearea">
  <table cellspacing="0" cellpadding="5px" width="100%">
   <tbody>
   <tr style="vertical-align: bottom">
    <td id="projectlogo"><a href="https://hepfit.roma1.infn.it/"><img style="height: 80px; margin-bottom: -3px; margin-top: -17px" alt="Logo" src="../../HEPfit-logo-Doxygen.png"/></a>
     <span style="font-size: 36px; font-family: monospace; color: #3b6f74; letter-spacing: 1px" id="projectnumber"> v1.0</span>
    </td>
    <td style="text-align: center;padding-left: 15px">
     <span style="font-size: 22px; font-family: monospace; color: #3b6f74; letter-spacing: 1px; font-weight: bold" id="projectnumber"> a Code for the Combination of Indirect and Direct Constraints on High Energy Physics Models</span>
    </td>
    <td>
     <img style="height: 95px; margin-bottom: -3px; margin-top: -20px; padding-right: 5px;" alt="Logo" src="../../collision.png"/>
    </td>
<!--    <td id="projectalign">-->
<!--     <div id="projectname">-->
<!--      HEPfit-->
      &#160;
<!--      <span style="font-size: 32px; font-family: monospace; float: left" id="projectnumber">v1.0</span>-->
<!--     </div>-->
<!--     <div id="projectbrief">A Code for the Combination of Indirect and Direct Constraints on High Energy Physics Models.</div>-->
<!--    </td>-->
   </tr>
   </tbody>
  </table>
 </div>
 <!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d0/dde/_page_usage.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md33">Monte Carlo mode</a><ul><li class="level2"><a href="#autotoc_md34">Step 1: %Model configuration file:</a></li>
<li class="level2"><a href="#autotoc_md35">Step 2: %Monte Carlo configuration file:</a></li>
<li class="level2"><a href="#autotoc_md36">Step 3: Run:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md37">Library mode with MCMC</a><ul><li class="level2"><a href="#autotoc_md38">Alternative: Run with MPI.</a></li>
<li class="level2"><a href="#autotoc_md39">Output Files:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md40">Single event mode</a></li>
<li class="level1"><a href="#autotoc_md41">Library mode without MCMC</a><ul><li class="level2"><a href="#autotoc_md42">Non-Minimal Mode:</a></li>
<li class="level2"><a href="#autotoc_md43">Minimal Mode:</a></li>
<li class="level2"><a href="#autotoc_md44">Use of hepfit-config:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md57">Monte Carlo mode</a><ul><li class="level2"><a href="#autotoc_md58">Step 1: %Model configuration file:</a></li>
<li class="level2"><a href="#autotoc_md59">Step 2: %Monte Carlo configuration file:</a></li>
<li class="level2"><a href="#autotoc_md60">Step 3: Run:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md61">Library mode with MCMC</a><ul><li class="level2"><a href="#autotoc_md62">Alternative: Run with MPI.</a></li>
<li class="level2"><a href="#autotoc_md63">Output Files:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md64">Single event mode</a></li>
<li class="level1"><a href="#autotoc_md65">Library mode without MCMC</a><ul><li class="level2"><a href="#autotoc_md66">Non-Minimal Mode:</a></li>
<li class="level2"><a href="#autotoc_md67">Minimal Mode:</a></li>
<li class="level2"><a href="#autotoc_md68">Use of hepfit-config:</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>The HEPfit installer generates the library <code>"libSufyFit.a"</code> along with header files including a combined header file, HEPfit.h. To perform a Bayesian statistical analysis with the Markov Chain Monte Carlo [<b>Library mode with MCMC</b>] one can use the given example implementation. Alternatively, one can use the library to obtain predictions of observables for a given point in the parameter space of the model, allowing our computational tool to be called from the user's own program [<b>Library mode without MCMC</b>].</p>
<h1><a class="anchor" id="autotoc_md33"></a>
Monte Carlo mode</h1>
<p>The Monte Carlo analysis is performed with the <a href="https://www.mppmu.mpg.de/bat/">BAT library</a>. First, a text configuration file containing a list of model parameters, model flags and observables to be analyzed has to be prepared. Another configuration file for the Monte Carlo run has to be prepared, too.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Step 1: %Model configuration file:</h2>
<p>A configuration file for model parameters, model flags and observables are written as follows:</p>
<div class="fragment"><div class="line">StandardModel</div>
<div class="line"># Model parameters:</div>
<div class="line">ModelParameter  mtop        173.2       0.9         0.  </div>
<div class="line">ModelParameter  mHl         125.6       0.3         0.  </div>
<div class="line">...</div>
<div class="line">CorrelatedGaussianParameters   V1_lattice 2</div>
<div class="line">ModelParameter  a_0V    0.496   0.067   0.</div>
<div class="line">ModelParameter  a_1V   -2.03    0.92    0.</div>
<div class="line">1.00    0.86</div>
<div class="line">0.86    1.00</div>
<div class="line"> </div>
<div class="line">&lt;All the model parameters have to be listed here&gt;</div>
<div class="line"> </div>
<div class="line"># Observables:</div>
<div class="line">Observable  Mw        Mw        M_{W}      80.3290 80.4064 MCMC weight 80.385 0.015 0.  </div>
<div class="line">Observable  GammaW    GammaW    #Gamma_{W} 2.08569 2.09249 MCMC weight 2.085  0.042 0.  </div>
<div class="line">#</div>
<div class="line"># Correlated observables:</div>
<div class="line">CorrelatedGaussianObservables Zpole2 7  </div>
<div class="line">Observable  Alepton   Alepton   A_{l}      0.143568 0.151850 MCMC weight 0.1513  0.0021  0.  </div>
<div class="line">Observable  Rbottom   Rbottom   R_{b}      0.215602 0.215958 MCMC weight 0.21629 0.00066 0.  </div>
<div class="line">Observable  Rcharm    Rcharm    R_{c}      0.172143 0.172334 MCMC weight 0.1721  0.0030  0.  </div>
<div class="line">Observable  AFBbottom AFBbottom A_{FB}^{b} 0.100604 0.106484 MCMC weight 0.0992  0.0016  0.  </div>
<div class="line">Observable  AFBcharm  AFBcharm  A_{FB}^{c} 0.071750 0.076305 MCMC weight 0.0707  0.0035  0.  </div>
<div class="line">Observable  Abottom   Abottom   A_{b}      0.934320 0.935007 MCMC weight 0.923   0.020   0.  </div>
<div class="line">Observable  Acharm    Acharm    A_{c}      0.666374 0.670015 MCMC weight 0.670   0.027   0.  </div>
<div class="line">1.00   0.00   0.00   0.00   0.00   0.09   0.05</div>
<div class="line">0.00   1.00  -0.18  -0.10   0.07  -0.08   0.04</div>
<div class="line">0.00  -0.18   1.00   0.04  -0.06   0.04  -0.06</div>
<div class="line">0.00  -0.10   0.04   1.00   0.15   0.06   0.01</div>
<div class="line">0.00   0.07  -0.06   0.15   1.00  -0.02   0.04</div>
<div class="line">0.09  -0.08   0.04   0.06  -0.02   1.00   0.11</div>
<div class="line">0.05   0.04  -0.06   0.01   0.04   0.11   1.00  </div>
<div class="line">#</div>
<div class="line"># Output correlations: </div>
<div class="line">Observable2D  MwvsGammaW Mw M_{W} 80.3290 80.4064 noMCMC noweight GammaW #Gamma_{W} 2.08569 2.09249  </div>
<div class="line">...</div>
<div class="line">Observable2D Bd_Bsbar_mumu noMCMC noweight</div>
<div class="line">Observable   BR_Bdmumu      BR(B_{d}#rightarrow#mu#mu)    1. -1.  1.05e-10   0.   0.</div>
<div class="line">Observable   BRbar_Bsmumu   BR(B_{s}#rightarrow#mu#mu)    1. -1.  3.65e-9    0.   0.</div>
<div class="line">...</div>
<div class="line">Observable2D S5_P5 noMCMC noweight</div>
<div class="line">BinnedObservable   S_5      S_5    1. -1.  0.   0.   0.   4.   6.</div>
<div class="line">BinnedObservable   P_5      P_5    1. -1.  0.   0.   0.   4.   6.</div>
<div class="line">#</div>
<div class="line"># Including other configuration files</div>
<div class="line">IncludeFile Flavour.conf</div>
</div><!-- fragment --><p>where the lines beginning with '#' are commented out.</p>
<p>Each line has to be written as follows:</p>
<ol type="1">
<li>The first line must be <b>the name of the model</b> to be analyzed, where the available models are listed in the page <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.<br  />
<br  />
</li>
<li><p class="startli"><b>A model parameter</b> is given in the format:</p>
<p class="startli"><code>ModelParameter &lt;name&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;</code></p>
<p class="startli">where all the parameters in a given model (see <a class="el" href="../../dd/dbf/_page_models.html">Models</a>) have to be listed in the configuration file.</p>
</li>
<li><b>A set of correlated model parameter</b> is specified with "CorrelatedGaussianParameters name Npar" which initializes a set of Npars correlated parameters. It must be followed by exactly Npar Parameter lines and then by Npar lines of Npar numbers for the correlation matrix. See the above example.</li>
<li><p class="startli">Optionally, one can set <b>a model flag</b> in the format:</p>
<p class="startli"><code>ModelFlag &lt;name&gt; &lt;value&gt;</code></p>
<p class="startli">where the available flags for a given model can be found in the page <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.</p>
</li>
<li><p class="startli"><b>An observable</b> to be computed is specified in one of the following formats:</p>
<p class="startli"><code>Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;</code><br  />
 <code>Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC file &lt;filename&gt; &lt;histoname&gt;</code><br  />
 <code>Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; noMCMC noweight</code></p><ul>
<li><code>&lt;name&gt;</code> is user given name for different observables which must be unique for each observable</li>
<li><code>&lt;obs label&gt;</code> is the theory label of the observable (see <a class="el" href="../../dd/dbf/_page_models.html">Models</a>).</li>
<li><code>&lt;histolabel&gt;</code> is used for the label of the output ROOT histogram, while <code>&lt;min&gt;</code> and <code>&lt;max&gt;</code> represent the range of the histogram.</li>
<li>(no)MCMC is the flag specifying whether the observable should be included in the Monte Carlo prerun or not</li>
<li>(no)weight specifies if the observable weight will be computed or not. If weigh is specified with noMCMC then the weight of the observable will be stored in the MCout*.root file</li>
<li>Experimental data is specified as <code>central value Gaussian error flat error</code>. If weight is specified both the errors cannot be 0.</li>
<li>A histogram in a ROOT file is specifed by the name of the root file (filename) and then the name of the histogram (histoname). <br  />
<br  />
</li>
</ul>
</li>
<li><b>Correlations among the data of observables</b> can be taken into account with the line "CorrelatedGaussianObservables name Nobs", which initializes a set of Nobs correlated observables. It must be followed by exactly Nobs Observable lines and then by Nobs lines of Nobs numbers for the correlation matrix. See the above example. One can use the keyword noMCMC and noweight, instead of MCMC and weight. <br  />
<br  />
</li>
<li><p class="startli"><b>A correlation between two observables</b> can be obtained with:</p>
<p class="startli"><code>Observable2D &lt;name&gt; &lt;obs1 label&gt; &lt;histolabel1&gt; &lt;min1&gt; &lt;max1&gt; noMCMC noweight &lt;obs2 label&gt; &lt;histolabel2&gt; &lt;min2&gt; &lt;max2&gt;</code><br  />
 <code>Observable2D &lt;name&gt; &lt;obs1 label&gt; &lt;histolabel1&gt; &lt;min1&gt; &lt;max1&gt; MCMC file &lt;filename&gt; &lt;histoname&gt; &lt;obs2 label&gt; &lt;histolabel2&gt; &lt;min2&gt; &lt;max2&gt;</code> <br  />
 or <br  />
 <code>Observable2D &lt;name&gt; (no)MCMC (no)weight</code><br  />
 <code>(Binned)Observable &lt;obs label 1&gt; &lt;histolabel 1&gt; &lt;min&gt; &lt;max&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
 <code>(Binned)Observable &lt;obs label 2&gt; &lt;histolabel 2&gt; &lt;min&gt; &lt;max&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
 <code>Observable2D &lt;name&gt; MCMC file filename histoname</code><br  />
 <code>(Binned)Observable &lt;obs label 1&gt; &lt;histolabel 1&gt; &lt;min&gt; &lt;max&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
 <code>(Binned)Observable &lt;obs label 2&gt; &lt;histolabel 2&gt; &lt;min&gt; &lt;max&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
</p>
</li>
<li><b>Include configuration files</b> with the IncludeFile directive. This is useful if one wants to separate the input configurations for better organization and flexibility.</li>
</ol>
<h2><a class="anchor" id="autotoc_md35"></a>
Step 2: %Monte Carlo configuration file:</h2>
<p>The parameters and options of the Monte Carlo run are specified in a configuration file, separate from the one for model parameters, etc. Each line in the file has a pair of a label and its value, separated by space(s) or tab(s). The available parameters and options are:</p>
<ul>
<li><b>NChains</b> : The number of chains in the Monte Carlo run. A minimum of 5 is suggested (default). If the theory space is complicated and/or the number of parameters are large then more is necessary. The amount of statistics collected in the main run is proportional to the numbe rof chains.</li>
<li><b>PrerunMaxIter</b> : The maximum number of iterations that the prerun will go through (default: 1000000). The prerun ends automatically when the chains converge (R &lt; 1.1) and all efficiencies are adjusted. While it is not necessary for the prerun to converge for a run to be successful, one should exercise caution in this case.</li>
<li><b>Iterations</b> : The number of iterations in the main run. This run is for the purpose of collecting statistics and is at the users discretion. (default: 100000)</li>
<li><b>Seed</b> : The seed can be fixed for deterministic runs.</li>
<li><b>PrintAllMarginalized</b> : All marginalized distributions will be printed in a pdf file (MonteCarlo_plots_*.pdf).</li>
<li><b>PrintCorrelationMatrix</b> : The parametric corellation will be printer in ParamCorrelations*.pdf and ParamCorrelations*.tex.</li>
<li><b>PrintKnowledgeUpdatePlots</b> : A comparison between prior and posterior knowledge will be printed in a plot stored in ParamUpdate*.pdf.</li>
<li><b>PrintParameterPlot</b> : As summary of the paramters will be printed in ParamSummary*.pdf.</li>
<li><b>OrderParameters</b> : This determines whether the parameters will be randomized one at a time or as a whole set in the entire run. While for quick estimates it is not necessary to order the prameters (false), it is suggested to do so for more accurate estimates.</li>
<li><b>FindModeWithMinuit</b> : To find global mode with MINUIT starting from the best fit parameters in the MCMC run.</li>
<li><b>MinimumEfficiency</b> : This allows the setting of the minimum eifficiency of all the prameters. The default is 0.15.</li>
<li><b>WriteChain</b> : The chains will be written in the root file MCout*.root. This can be used for analyzing the performance of the chains.</li>
<li><b>CalculateNormalization</b> : The normalization of the theory space will be calculated at the end of the Monte Carlo run. This is useful for model comparison.</li>
<li><b>WritePreRunData</b> : The prerun data is written to a file for rerun. <br  />
</li>
<li><b>ReadPreRunData</b> : The prerun data will be read from a previously stored prerun file.</li>
</ul>
<p>For example, a Monte Carlo configuration file is written as:</p>
<div class="fragment"><div class="line">NChains                    10    (Default: 5)</div>
<div class="line">PrerunMaxIter              50000 (Default: 1000000)</div>
<div class="line">Iterations                 10000 (Default: 100000)</div>
<div class="line">#Seed                       1</div>
<div class="line">PrintAllMarginalized       true  (Default: false)</div>
<div class="line">PrintCorrelationMatrix     true  (Default: false)    </div>
<div class="line">PrintKnowledgeUpdatePlots  false (Default: false)</div>
<div class="line">PrintParameterPlot         false (Default: false)</div>
<div class="line">OrderParameters            true  (Default: true)</div>
</div><!-- fragment --><p>where a '#' can be placed at the beginning of each line to comment it out. These are the most commonly used settings. Some less commonly used settings:</p>
<div class="fragment"><div class="line">FindModeWithMinuit      (Default: false)</div>
<div class="line">MinimumEfficiency       (Default: 0.15, set to 0. - 1.)</div>
<div class="line">WriteChain              (Default: false)</div>
<div class="line">CalculateNormalization  (Default: false)</div>
<div class="line">WritePreRunData         (Mandatory: name of file)</div>
<div class="line">ReadPreRunData          (Read existing prerun data file)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
Step 3: Run:</h2>
<h1><a class="anchor" id="autotoc_md37"></a>
Library mode with MCMC</h1>
<p>An example can be found in examples/MonteCarloMode</p>
<div class="fragment"><div class="line">$ cd examples/MonteCarloMode</div>
<div class="line">$ make</div>
</div><!-- fragment --><p>After making the configuration files, run with the command:</p>
<div class="fragment"><div class="line">$ analysis &lt;model conf&gt; &lt;Monte Carlo conf&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Alternative: Run with MPI.</h2>
<p>HEPfit allows for parallel processing of the MCMC run and the observable computations. To allow for this HEPfit and BAT has to be compiled with MPI support as explained in the <a class="el" href="../../d6/d57/_page_installation.html">Installation</a> page. The command</p>
<div class="fragment"><div class="line">$ mpiexec -n N analysis &lt;model conf&gt; &lt;Monte Carlo conf&gt;</div>
</div><!-- fragment --><p>will launch analysis on <code>N</code> thread/cores/processors depending on the smallest processing unit of the hardware used. Our MPI implementation allows for runs on multi-threaded single processors as well as clusters with MPI support.</p>
<p><b>NOTE:</b> Our MPI implementation of HEPfit cannot be used with BAT compiled with the <code>--enable-parallelization</code> option. It is mandatory to use the MPI patched version of BAT as explained in the <a class="el" href="../../d6/d57/_page_installation.html">Installation</a> page.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Output Files:</h2>
<ul>
<li>log.txt: This is the log file.</li>
<li>MCout.root: This is the root file containing all the information of the run and the histogram objects.</li>
<li>MonteCarlo_results.txt: This file contains the fits to the parameters.</li>
<li>MonteCarlo_plots.pdf: This File contains the histograms for the parameters.</li>
<li>Observables: This directory will contain the histograms of all the observables specified in the config file.</li>
<li>Observables/HistoLog.txt: This file contains the information on over-run and under-run of the histogram filling.</li>
<li>Observables/Statistics.txt: This file contains the compilation of the statistics extracted from the histograms.</li>
</ul>
<p>Other files might be generated depending on the options specified in the Monte Carlo configuration file.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Single event mode</h1>
<p>Using the model configuration file used in the Monte Carlo mode, one can obtain predictions of observabes for the central values of the model parameters with the command:</p>
<div class="fragment"><div class="line">$ analysis &lt;model conf&gt; --noMC</div>
</div><!-- fragment --><p>where the results are printed on the standard output.</p>
<h1><a class="anchor" id="autotoc_md41"></a>
Library mode without MCMC</h1>
<p>The library mode allows for access to all the observables implemented in HEPfit without a Monte Carlo run. The users can use one of our defined <a class="el" href="../../dd/dbf/_page_models.html">Models</a> and vary ModelParameters according to their own algorithm and get the corresponding predictions for the observables.</p>
<p>This is made possible through:</p>
<ul>
<li>a combined library: libHEPfit.a (installed in <code>HEPFIT_INSTALL_DIR/lib/</code></li>
<li>a combined header file: HEPfit.h (installed in <code>HEPFIT_INSTALL_DIR/include/HEPfit/</code>)</li>
</ul>
<p>The HEPfit library allows for two different implementations of the access algorithm.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Non-Minimal Mode:</h2>
<p>In the non-minimal mode the user can use the SomeModel.conf file to pass the default value of the model parameters. The following elements must be present in the user code to define the parameters and access the observable. (For details of model parameters, observables etc. please lookup <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.)</p>
<div class="fragment"><div class="line"><span class="comment">// Include the necessary header file. </span></div>
<div class="line"><span class="preprocessor">#include &lt;HEPfit.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the model configuration file. </span></div>
<div class="line">std::string ModelConf = <span class="stringliteral">&quot;SomeModel.conf&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the observables. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DObs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the parameters to be varied.</span></div>
<div class="line">std::map&lt;std::string, double&gt; DPars;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the observables to be returned. </span></div>
<div class="line">DObs[<span class="stringliteral">&quot;Mw&quot;</span>] = 0;</div>
<div class="line">DObs[<span class="stringliteral">&quot;GammaZ&quot;</span>] = 0.;</div>
<div class="line">DObs[<span class="stringliteral">&quot;AFBbottom&quot;</span>] = 0.;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and object of the class ComputeObservables. </span></div>
<div class="line"><a class="code" href="../../dd/d3e/class_compute_observables.html">ComputeObservables</a> CO(ModelConf, DObs);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Vary the parameters that need to be varied in the analysis. </span></div>
<div class="line">DPars[<span class="stringliteral">&quot;Mz&quot;</span>] = 91.1875;</div>
<div class="line">DPars[<span class="stringliteral">&quot;AlsMz&quot;</span>] = 0.1184;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the map of observables with the parameter values defined above. </span></div>
<div class="line">DObs = CO.compute(DPars);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
Minimal Mode:</h2>
<p>In the minimal mode the user can use the default values in <a class="el" href="../../dd/da7/class_input_parameters.html" title="A class for defining the default values of the mandatory parameters of the model being used on the li...">InputParameters</a> header file to define the default values of the model parameters therefore not requiring any additional input files to be parsed. (For details of model name, flags, parameters, observables etc. please lookup <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.)</p>
<div class="fragment"><div class="line"><span class="comment">// Include the necessary header file. </span></div>
<div class="line"><span class="preprocessor">#include &lt;HEPfit.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the observables. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DObs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the mandatory model parameters used during initializing a model. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DPars_IN;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the parameters to be varied. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DPars;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the model flags. </span></div>
<div class="line">std::map&lt;std::string, std::string&gt; DFlags;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the name of the model to be used. </span></div>
<div class="line">std::string ModelName = <span class="stringliteral">&quot;NPZbbbar&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and object of the class InputParameters. </span></div>
<div class="line"><a class="code" href="../../dd/da7/class_input_parameters.html">InputParameters</a> IP;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read a map for the mandatory model parameters. (Default values in InputParameters.h) </span></div>
<div class="line">DPars_IN = IP.<a class="code" href="../../dd/da7/class_input_parameters.html#a78a60b93b32047d18d50c85d7a2bf1bf">getInputParameters</a>(ModelName);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Change the default values of the mandatory model parameters if necessary. </span></div>
<div class="line"><span class="comment">// This can also be done with Dpars after creating an object of ComputeObservables </span></div>
<div class="line">DPars_IN[<span class="stringliteral">&quot;mcharm&quot;</span>] = 1.3;</div>
<div class="line">DPars_IN[<span class="stringliteral">&quot;mub&quot;</span>] = 4.2;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the observables to be returned. </span></div>
<div class="line">DObs[<span class="stringliteral">&quot;Mw&quot;</span>] = 0;</div>
<div class="line">DObs[<span class="stringliteral">&quot;GammaZ&quot;</span>] = 0.;</div>
<div class="line">DObs[<span class="stringliteral">&quot;AFBbottom&quot;</span>] = 0.;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the model flags to be set. </span></div>
<div class="line">DFlags[<span class="stringliteral">&quot;NPZbbbarLR&quot;</span>] = <span class="stringliteral">&quot;TRUE&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and object of the class ComputeObservables. </span></div>
<div class="line"><a class="code" href="../../dd/d3e/class_compute_observables.html">ComputeObservables</a> CO(ModelName, DPars_IN, DObs);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the flags for the model being used, if necessary. </span></div>
<div class="line">CO.setFlags(DFlags);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Vary the parameters that need to be varied in the analysis. </span></div>
<div class="line">DPars[<span class="stringliteral">&quot;mtop&quot;</span>] = 170.0;</div>
<div class="line">DPars[<span class="stringliteral">&quot;mHl&quot;</span>] = 126.0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the map of observables with the parameter values defined above. </span></div>
<div class="line">DObs = CO.compute(DPars);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md44"></a>
Use of hepfit-config:</h2>
<p>If &lsquo;'make install&rsquo;<code>has been done, a hepfit-config script can be found in the </code>HEPFIT_INSTALL_DIR/bin/` directory, which can be invoked with the following options:</p>
<div class="fragment"><div class="line">Library and Library Path: hepfit-config --libs</div>
<div class="line"> </div>
<div class="line">Include Path: hepfit-config --cflags</div>
<div class="line"> </div>
<div class="line">Parameters List: hepfit-config --variable=parameters | sh</div>
</div><!-- fragment --><p>The last command lists all the mandatory parameters in all the models sorted alphabetically and their default values as set in the class <a class="el" href="../../dd/da7/class_input_parameters.html" title="A class for defining the default values of the mandatory parameters of the model being used on the li...">InputParameters</a>.</p>
<p>The HEPfit installer generates the library <code>"libSufyFit.a"</code> along with header files including a combined header file, HEPfit.h. To perform a Bayesian statistical analysis with the Markov Chain Monte Carlo [<b>Library mode with MCMC</b>] one can use the given example implementation. Alternatively, one can use the library to obtain predictions of observables for a given point in the parameter space of the model, allowing our computational tool to be called from the user's own program [<b>Library mode without MCMC</b>].</p>
<h1><a class="anchor" id="autotoc_md57"></a>
Monte Carlo mode</h1>
<p>The Monte Carlo analysis is performed with the <a href="https://www.mppmu.mpg.de/bat/">BAT library</a>. First, a text configuration file containing a list of model parameters, model flags and observables to be analyzed has to be prepared. Another configuration file for the Monte Carlo run has to be prepared, too.</p>
<h2><a class="anchor" id="autotoc_md58"></a>
Step 1: %Model configuration file:</h2>
<p>A configuration file for model parameters, model flags and observables are written as follows:</p>
<div class="fragment"><div class="line">StandardModel</div>
<div class="line"># Model parameters:</div>
<div class="line">ModelParameter  mtop        173.2       0.9         0.  </div>
<div class="line">ModelParameter  mHl         125.6       0.3         0.  </div>
<div class="line">...</div>
<div class="line">CorrelatedGaussianParameters   V1_lattice 2</div>
<div class="line">ModelParameter  a_0V    0.496   0.067   0.</div>
<div class="line">ModelParameter  a_1V   -2.03    0.92    0.</div>
<div class="line">1.00    0.86</div>
<div class="line">0.86    1.00</div>
<div class="line"> </div>
<div class="line">&lt;All the model parameters have to be listed here&gt;</div>
<div class="line"> </div>
<div class="line"># Observables:</div>
<div class="line">Observable  Mw        Mw        M_{W}      80.3290 80.4064 MCMC weight 80.385 0.015 0.  </div>
<div class="line">Observable  GammaW    GammaW    #Gamma_{W} 2.08569 2.09249 MCMC weight 2.085  0.042 0.  </div>
<div class="line">#</div>
<div class="line"># Correlated observables:</div>
<div class="line">CorrelatedGaussianObservables Zpole2 7  </div>
<div class="line">Observable  Alepton   Alepton   A_{l}      0.143568 0.151850 MCMC weight 0.1513  0.0021  0.  </div>
<div class="line">Observable  Rbottom   Rbottom   R_{b}      0.215602 0.215958 MCMC weight 0.21629 0.00066 0.  </div>
<div class="line">Observable  Rcharm    Rcharm    R_{c}      0.172143 0.172334 MCMC weight 0.1721  0.0030  0.  </div>
<div class="line">Observable  AFBbottom AFBbottom A_{FB}^{b} 0.100604 0.106484 MCMC weight 0.0992  0.0016  0.  </div>
<div class="line">Observable  AFBcharm  AFBcharm  A_{FB}^{c} 0.071750 0.076305 MCMC weight 0.0707  0.0035  0.  </div>
<div class="line">Observable  Abottom   Abottom   A_{b}      0.934320 0.935007 MCMC weight 0.923   0.020   0.  </div>
<div class="line">Observable  Acharm    Acharm    A_{c}      0.666374 0.670015 MCMC weight 0.670   0.027   0.  </div>
<div class="line">1.00   0.00   0.00   0.00   0.00   0.09   0.05</div>
<div class="line">0.00   1.00  -0.18  -0.10   0.07  -0.08   0.04</div>
<div class="line">0.00  -0.18   1.00   0.04  -0.06   0.04  -0.06</div>
<div class="line">0.00  -0.10   0.04   1.00   0.15   0.06   0.01</div>
<div class="line">0.00   0.07  -0.06   0.15   1.00  -0.02   0.04</div>
<div class="line">0.09  -0.08   0.04   0.06  -0.02   1.00   0.11</div>
<div class="line">0.05   0.04  -0.06   0.01   0.04   0.11   1.00  </div>
<div class="line">#</div>
<div class="line"># Output correlations: </div>
<div class="line">Observable2D  MwvsGammaW Mw M_{W} 80.3290 80.4064 noMCMC noweight GammaW #Gamma_{W} 2.08569 2.09249  </div>
<div class="line">...</div>
<div class="line">Observable2D Bd_Bsbar_mumu noMCMC noweight</div>
<div class="line">Observable   BR_Bdmumu      BR(B_{d}#rightarrow#mu#mu)    1. -1.  1.05e-10   0.   0.</div>
<div class="line">Observable   BRbar_Bsmumu   BR(B_{s}#rightarrow#mu#mu)    1. -1.  3.65e-9    0.   0.</div>
<div class="line">...</div>
<div class="line">Observable2D S5_P5 noMCMC noweight</div>
<div class="line">BinnedObservable   S_5      S_5    1. -1.  0.   0.   0.   4.   6.</div>
<div class="line">BinnedObservable   P_5      P_5    1. -1.  0.   0.   0.   4.   6.</div>
<div class="line">#</div>
<div class="line"># Including other configuration files</div>
<div class="line">IncludeFile Flavour.conf</div>
</div><!-- fragment --><p>where the lines beginning with '#' are commented out.</p>
<p>Each line has to be written as follows:</p>
<ol type="1">
<li>The first line must be <b>the name of the model</b> to be analyzed, where the available models are listed in the page <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.<br  />
<br  />
</li>
<li><p class="startli"><b>A model parameter</b> is given in the format:</p>
<p class="startli"><code>ModelParameter &lt;name&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;</code></p>
<p class="startli">where all the parameters in a given model (see <a class="el" href="../../dd/dbf/_page_models.html">Models</a>) have to be listed in the configuration file.</p>
</li>
<li><b>A set of correlated model parameter</b> is specified with "CorrelatedGaussianParameters name Npar" which initializes a set of Npars correlated parameters. It must be followed by exactly Npar Parameter lines and then by Npar lines of Npar numbers for the correlation matrix. See the above example.</li>
<li><p class="startli">Optionally, one can set <b>a model flag</b> in the format:</p>
<p class="startli"><code>ModelFlag &lt;name&gt; &lt;value&gt;</code></p>
<p class="startli">where the available flags for a given model can be found in the page <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.</p>
</li>
<li><p class="startli"><b>An observable</b> to be computed is specified in one of the following formats:</p>
<p class="startli"><code>Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;</code><br  />
 <code>Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC file &lt;filename&gt; &lt;histoname&gt;</code><br  />
 <code>Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; noMCMC noweight</code></p><ul>
<li><code>&lt;name&gt;</code> is user given name for different observables which must be unique for each observable</li>
<li><code>&lt;obs label&gt;</code> is the theory label of the observable (see <a class="el" href="../../dd/dbf/_page_models.html">Models</a>).</li>
<li><code>&lt;histolabel&gt;</code> is used for the label of the output ROOT histogram, while <code>&lt;min&gt;</code> and <code>&lt;max&gt;</code> represent the range of the histogram.</li>
<li>(no)MCMC is the flag specifying whether the observable should be included in the Monte Carlo prerun or not</li>
<li>(no)weight specifies if the observable weight will be computed or not. If weigh is specified with noMCMC then the weight of the observable will be stored in the MCout*.root file</li>
<li>Experimental data is specified as <code>central value Gaussian error flat error</code>. If weight is specified both the errors cannot be 0.</li>
<li>A histogram in a ROOT file is specifed by the name of the root file (filename) and then the name of the histogram (histoname). <br  />
<br  />
</li>
</ul>
</li>
<li><b>Correlations among the data of observables</b> can be taken into account with the line "CorrelatedGaussianObservables name Nobs", which initializes a set of Nobs correlated observables. It must be followed by exactly Nobs Observable lines and then by Nobs lines of Nobs numbers for the correlation matrix. See the above example. One can use the keyword noMCMC and noweight, instead of MCMC and weight. <br  />
<br  />
</li>
<li><p class="startli"><b>A correlation between two observables</b> can be obtained with:</p>
<p class="startli"><code>Observable2D &lt;name&gt; &lt;obs1 label&gt; &lt;histolabel1&gt; &lt;min1&gt; &lt;max1&gt; noMCMC noweight &lt;obs2 label&gt; &lt;histolabel2&gt; &lt;min2&gt; &lt;max2&gt;</code><br  />
 <code>Observable2D &lt;name&gt; &lt;obs1 label&gt; &lt;histolabel1&gt; &lt;min1&gt; &lt;max1&gt; MCMC file &lt;filename&gt; &lt;histoname&gt; &lt;obs2 label&gt; &lt;histolabel2&gt; &lt;min2&gt; &lt;max2&gt;</code> <br  />
 or <br  />
 <code>Observable2D &lt;name&gt; (no)MCMC (no)weight</code><br  />
 <code>(Binned)Observable &lt;obs label 1&gt; &lt;histolabel 1&gt; &lt;min&gt; &lt;max&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
 <code>(Binned)Observable &lt;obs label 2&gt; &lt;histolabel 2&gt; &lt;min&gt; &lt;max&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
 <code>Observable2D &lt;name&gt; MCMC file filename histoname</code><br  />
 <code>(Binned)Observable &lt;obs label 1&gt; &lt;histolabel 1&gt; &lt;min&gt; &lt;max&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
 <code>(Binned)Observable &lt;obs label 2&gt; &lt;histolabel 2&gt; &lt;min&gt; &lt;max&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)</code><br  />
</p>
</li>
<li><b>Include configuration files</b> with the IncludeFile directive. This is useful if one wants to separate the input configurations for better organization and flexibility.</li>
</ol>
<h2><a class="anchor" id="autotoc_md59"></a>
Step 2: %Monte Carlo configuration file:</h2>
<p>The parameters and options of the Monte Carlo run are specified in a configuration file, separate from the one for model parameters, etc. Each line in the file has a pair of a label and its value, separated by space(s) or tab(s). The available parameters and options are:</p>
<ul>
<li><b>NChains</b> : The number of chains in the Monte Carlo run. A minimum of 5 is suggested (default). If the theory space is complicated and/or the number of parameters are large then more is necessary. The amount of statistics collected in the main run is proportional to the numbe rof chains.</li>
<li><b>PrerunMaxIter</b> : The maximum number of iterations that the prerun will go through (default: 1000000). The prerun ends automatically when the chains converge (R &lt; 1.1) and all efficiencies are adjusted. While it is not necessary for the prerun to converge for a run to be successful, one should exercise caution in this case.</li>
<li><b>Iterations</b> : The number of iterations in the main run. This run is for the purpose of collecting statistics and is at the users discretion. (default: 100000)</li>
<li><b>Seed</b> : The seed can be fixed for deterministic runs.</li>
<li><b>PrintAllMarginalized</b> : All marginalized distributions will be printed in a pdf file (MonteCarlo_plots_*.pdf).</li>
<li><b>PrintCorrelationMatrix</b> : The parametric corellation will be printer in ParamCorrelations*.pdf and ParamCorrelations*.tex.</li>
<li><b>PrintKnowledgeUpdatePlots</b> : A comparison between prior and posterior knowledge will be printed in a plot stored in ParamUpdate*.pdf.</li>
<li><b>PrintParameterPlot</b> : As summary of the paramters will be printed in ParamSummary*.pdf.</li>
<li><b>OrderParameters</b> : This determines whether the parameters will be randomized one at a time or as a whole set in the entire run. While for quick estimates it is not necessary to order the prameters (false), it is suggested to do so for more accurate estimates.</li>
<li><b>FindModeWithMinuit</b> : To find global mode with MINUIT starting from the best fit parameters in the MCMC run.</li>
<li><b>MinimumEfficiency</b> : This allows the setting of the minimum eifficiency of all the prameters. The default is 0.15.</li>
<li><b>WriteChain</b> : The chains will be written in the root file MCout*.root. This can be used for analyzing the performance of the chains.</li>
<li><b>CalculateNormalization</b> : The normalization of the theory space will be calculated at the end of the Monte Carlo run. This is useful for model comparison.</li>
<li><b>WritePreRunData</b> : The prerun data is written to a file for rerun. <br  />
</li>
<li><b>ReadPreRunData</b> : The prerun data will be read from a previously stored prerun file.</li>
</ul>
<p>For example, a Monte Carlo configuration file is written as:</p>
<div class="fragment"><div class="line">NChains                    10    (Default: 5)</div>
<div class="line">PrerunMaxIter              50000 (Default: 1000000)</div>
<div class="line">Iterations                 10000 (Default: 100000)</div>
<div class="line">#Seed                       1</div>
<div class="line">PrintAllMarginalized       true  (Default: false)</div>
<div class="line">PrintCorrelationMatrix     true  (Default: false)    </div>
<div class="line">PrintKnowledgeUpdatePlots  false (Default: false)</div>
<div class="line">PrintParameterPlot         false (Default: false)</div>
<div class="line">OrderParameters            true  (Default: true)</div>
</div><!-- fragment --><p>where a '#' can be placed at the beginning of each line to comment it out. These are the most commonly used settings. Some less commonly used settings:</p>
<div class="fragment"><div class="line">FindModeWithMinuit      (Default: false)</div>
<div class="line">MinimumEfficiency       (Default: 0.15, set to 0. - 1.)</div>
<div class="line">WriteChain              (Default: false)</div>
<div class="line">CalculateNormalization  (Default: false)</div>
<div class="line">WritePreRunData         (Mandatory: name of file)</div>
<div class="line">ReadPreRunData          (Read existing prerun data file)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md60"></a>
Step 3: Run:</h2>
<h1><a class="anchor" id="autotoc_md61"></a>
Library mode with MCMC</h1>
<p>An example can be found in examples/MonteCarloMode</p>
<div class="fragment"><div class="line">$ cd examples/MonteCarloMode</div>
<div class="line">$ make</div>
</div><!-- fragment --><p>After making the configuration files, run with the command:</p>
<div class="fragment"><div class="line">$ analysis &lt;model conf&gt; &lt;Monte Carlo conf&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md62"></a>
Alternative: Run with MPI.</h2>
<p>HEPfit allows for parallel processing of the MCMC run and the observable computations. To allow for this HEPfit and BAT has to be compiled with MPI support as explained in the <a class="el" href="../../d6/d57/_page_installation.html">Installation</a> page. The command</p>
<div class="fragment"><div class="line">$ mpiexec -n N analysis &lt;model conf&gt; &lt;Monte Carlo conf&gt;</div>
</div><!-- fragment --><p>will launch analysis on <code>N</code> thread/cores/processors depending on the smallest processing unit of the hardware used. Our MPI implementation allows for runs on multi-threaded single processors as well as clusters with MPI support.</p>
<p><b>NOTE:</b> Our MPI implementation of HEPfit cannot be used with BAT compiled with the <code>--enable-parallelization</code> option. It is mandatory to use the MPI patched version of BAT as explained in the <a class="el" href="../../d6/d57/_page_installation.html">Installation</a> page.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
Output Files:</h2>
<ul>
<li>log.txt: This is the log file.</li>
<li>MCout.root: This is the root file containing all the information of the run and the histogram objects.</li>
<li>MonteCarlo_results.txt: This file contains the fits to the parameters.</li>
<li>MonteCarlo_plots.pdf: This File contains the histograms for the parameters.</li>
<li>Observables: This directory will contain the histograms of all the observables specified in the config file.</li>
<li>Observables/HistoLog.txt: This file contains the information on over-run and under-run of the histogram filling.</li>
<li>Observables/Statistics.txt: This file contains the compilation of the statistics extracted from the histograms.</li>
</ul>
<p>Other files might be generated depending on the options specified in the Monte Carlo configuration file.</p>
<h1><a class="anchor" id="autotoc_md64"></a>
Single event mode</h1>
<p>Using the model configuration file used in the Monte Carlo mode, one can obtain predictions of observabes for the central values of the model parameters with the command:</p>
<div class="fragment"><div class="line">$ analysis &lt;model conf&gt; --noMC</div>
</div><!-- fragment --><p>where the results are printed on the standard output.</p>
<h1><a class="anchor" id="autotoc_md65"></a>
Library mode without MCMC</h1>
<p>The library mode allows for access to all the observables implemented in HEPfit without a Monte Carlo run. The users can use one of our defined <a class="el" href="../../dd/dbf/_page_models.html">Models</a> and vary ModelParameters according to their own algorithm and get the corresponding predictions for the observables.</p>
<p>This is made possible through:</p>
<ul>
<li>a combined library: libHEPfit.a (installed in <code>HEPFIT_INSTALL_DIR/lib/</code></li>
<li>a combined header file: HEPfit.h (installed in <code>HEPFIT_INSTALL_DIR/include/HEPfit/</code>)</li>
</ul>
<p>The HEPfit library allows for two different implementations of the access algorithm.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Non-Minimal Mode:</h2>
<p>In the non-minimal mode the user can use the SomeModel.conf file to pass the default value of the model parameters. The following elements must be present in the user code to define the parameters and access the observable. (For details of model parameters, observables etc. please lookup <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.)</p>
<div class="fragment"><div class="line"><span class="comment">// Include the necessary header file. </span></div>
<div class="line"><span class="preprocessor">#include &lt;HEPfit.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the model configuration file. </span></div>
<div class="line">std::string ModelConf = <span class="stringliteral">&quot;SomeModel.conf&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the observables. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DObs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the parameters to be varied.</span></div>
<div class="line">std::map&lt;std::string, double&gt; DPars;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the observables to be returned. </span></div>
<div class="line">DObs[<span class="stringliteral">&quot;Mw&quot;</span>] = 0;</div>
<div class="line">DObs[<span class="stringliteral">&quot;GammaZ&quot;</span>] = 0.;</div>
<div class="line">DObs[<span class="stringliteral">&quot;AFBbottom&quot;</span>] = 0.;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and object of the class ComputeObservables. </span></div>
<div class="line"><a class="code" href="../../dd/d3e/class_compute_observables.html">ComputeObservables</a> CO(ModelConf, DObs);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Vary the parameters that need to be varied in the analysis. </span></div>
<div class="line">DPars[<span class="stringliteral">&quot;Mz&quot;</span>] = 91.1875;</div>
<div class="line">DPars[<span class="stringliteral">&quot;AlsMz&quot;</span>] = 0.1184;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the map of observables with the parameter values defined above. </span></div>
<div class="line">DObs = CO.compute(DPars);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md67"></a>
Minimal Mode:</h2>
<p>In the minimal mode the user can use the default values in <a class="el" href="../../dd/da7/class_input_parameters.html" title="A class for defining the default values of the mandatory parameters of the model being used on the li...">InputParameters</a> header file to define the default values of the model parameters therefore not requiring any additional input files to be parsed. (For details of model name, flags, parameters, observables etc. please lookup <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.)</p>
<div class="fragment"><div class="line"><span class="comment">// Include the necessary header file. </span></div>
<div class="line"><span class="preprocessor">#include &lt;HEPfit.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the observables. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DObs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the mandatory model parameters used during initializing a model. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DPars_IN;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the parameters to be varied. </span></div>
<div class="line">std::map&lt;std::string, double&gt; DPars;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a map for the model flags. </span></div>
<div class="line">std::map&lt;std::string, std::string&gt; DFlags;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the name of the model to be used. </span></div>
<div class="line">std::string ModelName = <span class="stringliteral">&quot;NPZbbbar&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and object of the class InputParameters. </span></div>
<div class="line"><a class="code" href="../../dd/da7/class_input_parameters.html">InputParameters</a> IP;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read a map for the mandatory model parameters. (Default values in InputParameters.h) </span></div>
<div class="line">DPars_IN = IP.<a class="code" href="../../dd/da7/class_input_parameters.html#a78a60b93b32047d18d50c85d7a2bf1bf">getInputParameters</a>(ModelName);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Change the default values of the mandatory model parameters if necessary. </span></div>
<div class="line"><span class="comment">// This can also be done with Dpars after creating an object of ComputeObservables </span></div>
<div class="line">DPars_IN[<span class="stringliteral">&quot;mcharm&quot;</span>] = 1.3;</div>
<div class="line">DPars_IN[<span class="stringliteral">&quot;mub&quot;</span>] = 4.2;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the observables to be returned. </span></div>
<div class="line">DObs[<span class="stringliteral">&quot;Mw&quot;</span>] = 0;</div>
<div class="line">DObs[<span class="stringliteral">&quot;GammaZ&quot;</span>] = 0.;</div>
<div class="line">DObs[<span class="stringliteral">&quot;AFBbottom&quot;</span>] = 0.;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the model flags to be set. </span></div>
<div class="line">DFlags[<span class="stringliteral">&quot;NPZbbbarLR&quot;</span>] = <span class="stringliteral">&quot;TRUE&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and object of the class ComputeObservables. </span></div>
<div class="line"><a class="code" href="../../dd/d3e/class_compute_observables.html">ComputeObservables</a> CO(ModelName, DPars_IN, DObs);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the flags for the model being used, if necessary. </span></div>
<div class="line">CO.setFlags(DFlags);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Vary the parameters that need to be varied in the analysis. </span></div>
<div class="line">DPars[<span class="stringliteral">&quot;mtop&quot;</span>] = 170.0;</div>
<div class="line">DPars[<span class="stringliteral">&quot;mHl&quot;</span>] = 126.0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the map of observables with the parameter values defined above. </span></div>
<div class="line">DObs = CO.compute(DPars);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md68"></a>
Use of hepfit-config:</h2>
<p>If &lsquo;'make install&rsquo;<code>has been done, a hepfit-config script can be found in the </code>HEPFIT_INSTALL_DIR/bin/` directory, which can be invoked with the following options:</p>
<div class="fragment"><div class="line">Library and Library Path: hepfit-config --libs</div>
<div class="line"> </div>
<div class="line">Include Path: hepfit-config --cflags</div>
<div class="line"> </div>
<div class="line">Parameters List: hepfit-config --variable=parameters | sh</div>
</div><!-- fragment --><p>The last command lists all the mandatory parameters in all the models sorted alphabetically and their default values as set in the class <a class="el" href="../../dd/da7/class_input_parameters.html" title="A class for defining the default values of the mandatory parameters of the model being used on the li...">InputParameters</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_compute_observables_html"><div class="ttname"><a href="../../dd/d3e/class_compute_observables.html">ComputeObservables</a></div><div class="ttdoc">A class for providing access to the computation of observables without a Monte Carlo run.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dae/_compute_observables_8h_source.html#l00035">ComputeObservables.h:35</a></div></div>
<div class="ttc" id="aclass_input_parameters_html_a78a60b93b32047d18d50c85d7a2bf1bf"><div class="ttname"><a href="../../dd/da7/class_input_parameters.html#a78a60b93b32047d18d50c85d7a2bf1bf">InputParameters::getInputParameters</a></div><div class="ttdeci">std::map&lt; std::string, double &gt; getInputParameters(std::string &amp;ModelName)</div><div class="ttdoc">A method that returns the map of the mandatory model parameters given the model name.</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df8/_input_parameters_8h_source.html#l00039">InputParameters.h:39</a></div></div>
<div class="ttc" id="aclass_input_parameters_html"><div class="ttname"><a href="../../dd/da7/class_input_parameters.html">InputParameters</a></div><div class="ttdoc">A class for defining the default values of the mandatory parameters of the model being used on the li...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df8/_input_parameters_8h_source.html#l00019">InputParameters.h:19</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 29 2019 for $\texttt{HEPfit}$ using
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
